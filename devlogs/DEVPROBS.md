# 开发问题

## 设计/架构

### 删除内容连带删除空祖先的问题

> prob.
>
> 起初这么做是为了避免直接的 DOM 操作，导致文档中残留空节点碎片的问题。核心中的 handler 在删除内容时，会自动检查是否残留空祖先节点，如果有，将连带一起删除（除非是段落）。
>
> 但在开发表格时，这种“设计”遇到了麻烦。如`<td>a|</td>`，光标在`|`处，Backspace 会删除`|`前的`a`，此时触发空祖先检查，会连带把`<td>`也删除。但这是表格，删除一个单元格的行为会很奇怪，因为我们通常都是在某个表格行的所有单元格都为空时，整体删除行，而不是单独的删除某个单元格（除非是第一行）。
>
> 这个问题并不好解决，因为 v0.2 版本的设计中，我们没有便利的办法判断某个删除行为会让当前效应元素内容为空。因为该删除行为可能是 `opt + Backspace`删除单词，甚至是`cmd + Backspace`删除行。
>
> 最优雅的解决办法，就是将这种行为“效应化”，利用效应继承特性，交给效应元素自身决定如何处理：当核心在删除内容后发现空内容节点，则向上找连续的空祖先，当遇到的某个空祖先是效应元素，则激活对应的效应，判断是否应当连带删除。
>
> ✅ 或者缩小一些，使用效应码，拥有某个效应码的元素禁止被连带删除。

> sol. 新增效应类型 `AllowEmpty`

## 兼容

### 输入法

在空段落(display:block元素没有任何内容或只有一个\<br>) 内使用输入法输入内容时; chromium、firefox、safari 各有不同的处理. 但都不约而同的, 会自动插入或移除\<br> 元素.

其中 firefox 的处理, 最奇怪; 目前能找到的最好的解决办法, 就是让空段落内存留一个零宽字符, 这能在一定程度上避免浏览器插入<br>
